<!DOCTYPE html>
{% load static %}
<!-- {% static 'path' %} -->

<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

      <!-- Google fonts -->
    <link href="https://fonts.googleapis.com/css?family=Muli:300,700&display=swap" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="{% static 'video_tiktok/css/style/style.css' %}">


    <!-- Ionic icons -->
    <link href="https://unpkg.com/ionicons@4.5.10-0/dist/css/ionicons.min.css" rel="stylesheet">


    <title>Dashboard - VRLabs</title>

</head>

<body>
    <div class="d-flex" id="content-wrapper">

        <!-- Sidebar -->
        <div id="sidebar-container" class="bg-primary">
            <div class="logo">
                <h4 class="text-light font-weight-bold mb-0">VRLabs</h4>
            </div>
            <!--<div class="d-flex justify-content-center mt-3">
                <form class="form-inline position-relative my-2">
                <input class="form-control" type="search" placeholder="Buscar" aria-label="Buscar">
                <button class="btn position-absolute btn-search" type="submit"><i class="icon ion-md-search"></i></button>
            </form>

            </div>-->

            <div class="menu">
                <a href="#" class="d-block text-light p-3 border-0"><ion-icon name="videocam" class="mr-3 lead"></ion-icon> Estudio</a>

                <a href="#" class="d-block text-light p-3 border-0"><ion-icon name="card" class="mr-3 lead"></ion-icon> Créditos</a>

                <a href="#" class="d-block text-light p-3 border-0"><ion-icon name="person" class="mr-3 lead"></ion-icon> Perfil de usuario</a>
            </div>
        </div>
        <!-- Fin sidebar -->

        <div class="w-100">

         <!-- Navbar -->
         <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
            <div class="container">
    
              <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
    
              <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <form class="form-inline position-relative d-inline-block my-2">
                  <input class="form-control" type="search" placeholder="Buscar" aria-label="Buscar">
                  <button class="btn position-absolute btn-search" type="submit"><i class="icon ion-md-search"></i></button>
                </form>
                <ul class="navbar-nav ml-auto mt-2 mt-lg-0">
                  <li class="nav-item dropdown">
                    <a class="nav-link text-dark dropdown-toggle" href="#" id="navbarDropdown" role="button"
                      data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      <img src="{% static 'video_tiktok/img/user/user-1.png' %}" class="img-fluid rounded-circle avatar mr-2"
                           alt="" />Juan Pérez
                    </a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                      <a class="dropdown-item" href="#">Mi perfil</a>
                      <a class="dropdown-item" href="#">Suscripciones</a>
                      <div class="dropdown-divider"></div>
                      <a class="dropdown-item" href="#">Cerrar sesión</a>
                    </div>
                  </li>
                </ul>
              </div>
            </div>
          </nav>
          <!-- Fin Navbar -->

        <!-- Page Content -->
        <div id="content" class="bg-grey w-100">

              <section class="bg-light py-3">
                  <div class="container">
                      <div class="row">
                          <div class="col-lg-6 col-md-8">
                            <h1 class="font-weight-bold mb-0">Bienvenido Juan</h1>
                            <p class="lead text-muted">Crea un nuevo video</p>
                          </div>
                          <div class="col-lg-6 col-md-4 d-flex">
                            <!--<button class="btn btn-primary w-50 align-self-center">Descargar video</button> -->
                          </div>
                      </div>
                  </div>
              </section>

              <section>
                  <div class="container">
                      <div class="row">
                          <div class="col-lg-4 my-3">
                              <div class="card rounded-0">
                                  <div class="card-header bg-light">
                                    <h6 class="font-weight-bold mb-0">Tu video</h6>
                                  </div>
                                  <div class="card-body text-center">
                                    <video width="270" height="480" controls>
                                    <source src="{% static 'video_tiktok/videos/generated_videos/video_final.mp4' %}" type="video/mp4">


                                    Tu navegador no soporta la etiqueta de video.
                                    </video>

                                  </div>
                                  <!-- Botones debajo del reproductor de video -->
                                  <div class="mt-3 mb-3 d-flex justify-content-center">
                                      <button class="btn btn-secondary mr-2" onclick="handleButtonClick()">Intentar de nuevo</button>
                                      <!-- <button class="btn btn-primary">Descargar video</button> -->
                                      <a href="{% static 'video_tiktok/videos/generated_videos/video_final.mp4' %}" download class="btn btn-primary">Descargar video</a>

                                  </div>
                                  <div class="py-2 bg-light"> <!-- Añadido padding al footer -->
                                  </div>
                              </div>
                          </div>
                          <div class="col-lg-8 my-3">
                            <div class="card rounded-0 scrollable-card">
                                <div class="card-header bg-light">
                                    <h6 class="font-weight-bold mb-0">Comencemos... </h6>
                                </div>
                                <div class="card-body pt-2">
                                    <div class="container my-4">
                                        <div class="row">
                                            <div class="col-12">
                                                <form id="scriptForm">
                                                    {% csrf_token %}
                                                    <div class="form-group">
                                                        <label for="videoTitle">Título del Video</label>
                                                        <input type="text" class="form-control" id="videoTitle" placeholder="Escribe el título del video">
                                                    </div>

                                                    <div class="form-group">
                                                        <label for="videoScript">Guion del Video</label>
                                                        <textarea class="form-control" id="videoScript" rows="3" placeholder="Escribe el guion del video"></textarea>
                                                    </div>
                                                    <button type="button" class="btn btn-primary" onclick="generateScript()">Generar Guion</button>
                                                </form>
                                                <div class="form-group mt-4">
                                                    <label for="generatedScript">Guion Generado</label>
                                                    <textarea class="form-control" id="generatedScript" rows="3"></textarea>
                                                </div>
                                                <button type="button" class="btn btn-primary" onclick="generateImages()">Confirmar cambios</button>

                                            </div>
                                        </div>
                                    </div>

                                    <div id="imagesContainer">
                                        <!-- Miniaturas
                                        <div class="thumbnails">
                                            <img src="{% static 'video_tiktok/img/generated_images/imagen_0_thumbnail.png' %}" alt="Imagen 0" class="thumbnail" data-large="{% static 'video_tiktok/img/generated_images/imagen_0_thumbnail.png' %}">
                                            <img src="{% static 'video_tiktok/img/generated_images/imagen_1_thumbnail.png' %}" alt="Imagen 1" class="thumbnail" data-large="{% static 'video_tiktok/img/generated_images/imagen_1_thumbnail.png' %}">
                                            <img src="{% static 'video_tiktok/img/generated_images/imagen_2_thumbnail.png' %}" alt="Imagen 2" class="thumbnail" data-large="{% static 'video_tiktok/img/generated_images/imagen_2_thumbnail.png' %}">
                                            <img src="{% static 'video_tiktok/img/generated_images/imagen_3_thumbnail.png' %}" alt="Imagen 3" class="thumbnail" data-large="{% static 'video_tiktok/img/generated_images/imagen_3_thumbnail.png' %}">

                                        </div> -->

                                        <!-- Modal para la imagen en tamaño grande
                                        <div id="modal" class="modal">
                                            <span class="close" onclick="document.getElementById('modal').style.display='none'">&times;</span>
                                            <img class="modal-content" id="largeImage">
                                            <div id="caption"></div>
                                        </div> -->


                                    </div>

                                    <div class="form-group">
                                        <label for="voiceSelection">Selecciona una voz</label>
                                        <select class="form-control" id="voiceSelection">
                                            <option value="voice1">Voz 1</option>
                                            <option value="voice2">Voz 2</option>
                                        </select>
                                    </div>
                                    <div class="d-flex justify-content-center mt-3">
                                        <button id="generateVideoBtn" class="btn btn-primary w-50">Generar video</button>

                                    </div>
                                </div>
                            </div>
                          </div>
                      </div>
                  </div>
              </section>

        </div>

        </div>
    </div>

    <!-- Ionic icons -->
    <script  type = "module"  src = "https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script  nomodule  src = "https://unpkg .com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

     <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <!--<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>-->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>

    <script>
    function generateScript() {
        //Obtener los valores de los campos de entrada
        const title = $('#videoTitle').val();
        const script = $('#videoScript').val();


        //Enviar una solicitud POST a tu endpoint de Django para generar el guion -->
        $.ajax({
            type: 'POST',
            url: '{% url "generate_script" %}',
            data: {
                videoTitle: title,
                videoScript: script,
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
                },
            dataType: 'json',
            success: function (response) {
                $('#generatedScript').val(response.generated_script);
                },
            error: function (error) {
                console.log(error);
                }

            });
        }
    </script>
<script>
    function generateImages() {
        // Obtener el valor del guion generado, que el usuario puede haber editado
        const editedScript = $('#generatedScript').val();

        // Enviar una solicitud POST a tu endpoint de Django para generar las imágenes
        $.ajax({
            type: 'POST',
            url: '{% url "generate_images" %}',
            data: {
                editedScript: editedScript,
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
            },
            dataType: 'json',
            success: function (response) {
                console.log(response);
                // Limpiar cualquier imagen anteriormente mostrada
                $('#imagesContainer').empty();

                // Verificar si la respuesta contiene las rutas de las imágenes
                if (response.imagePaths && response.imagePaths.length > 0) {
                    // Iterar sobre las rutas de las imágenes y mostrarlas en la página
                    response.imagePaths.forEach(function(imageObject) {
                        console.log(imageObject); // Imprime el valor de imageObject

                        // Agregar timestamp para evitar problemas de caché
                        //const timestamp = new Date().getTime();

                        // Accede a las propiedades image y thumbnail del objeto
                        //const imagePath = imageObject.image;
                        //const thumbnailPath = imageObject.thumbnail;
                        //const thumbnailPath = imageObject.thumbnail + '?' + timestamp;

                        // Crear un elemento de imagen
                        const img = $('<img />', {
                            src: imagePath,
                            alt: 'Imagen generada'
                        });

                        // Crear un elemento de miniatura
                        //const thumbnail = $('<img />', {
                        //    src: thumbnailPath,
                        //    alt: 'Miniatura'
                        //});

                        // Añadir el elemento de imagen y de miniatura al contenedor de imágenes
                        //$('#imagesContainer').append(thumbnail);
                        $('#imagesContainer').append(img);
                    });
                } else {
                    // Mostrar un mensaje si no se encontraron imágenes
                    console.log('No se generaron imágenes');
                }
            },
            error: function (error) {
                console.log(error);
            }
        });
    }
    document.addEventListener("DOMContentLoaded", function() {
        // guardado en blog de notas
    });

</script>

<script type="text/javascript">
$(document).ready(function() {
    $("#generateVideoBtn").click(function() {
        $.ajax({
            type: "POST",
            url: "/generate_video/",
            data: {
                csrfmiddlewaretoken: "{{ csrf_token }}"
            },
            success: function(response) {
                // Aquí puedes manejar la respuesta, por ejemplo, mostrar un mensaje de éxito
                alert("Video generado con éxito!");
            },
            error: function(error) {
                // Manejo de errores
                alert("Hubo un problema al generar el video.");
            }
        });
    });
});
</script>

<script>
    function handleButtonClick() {
    $.ajax({
        type: "POST",
        url: "/delete_video/",
        data: {
            'video_path': 'ruta/del/video/final_video.mp4',
            'csrfmiddlewaretoken': '{{ csrf_token }}'
        },
        success: function(response) {
            if (response.success) {
                alert('Video eliminado exitosamente!');
            } else {
                alert('Error al eliminar el video.');
            }
        }
    });
}

</script>


</body>

</html>